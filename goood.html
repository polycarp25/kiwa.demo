<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kiwimbi Kenya Staff Attendance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              kiwimbi: {
                green: '#006A4E',
                darkgreen: '#004d38',
                lightgreen: '#EAF3F0',
                blue: '#1E90FF',
                dark: '#1a2a26',
              },
            },
            animation: {
              'slide-in': 'slide-in 0.3s ease-in-out',
            },
            keyframes: {
              'slide-in': {
                '0%': { transform: 'translateX(100%)', opacity: '0' },
                '100%': { transform: 'translateX(0)', opacity: '1' },
              },
            }
          },
        },
      }
    </script>
</head>
<body class="bg-kiwimbi-lightgreen dark:bg-kiwimbi-dark transition-colors duration-300 font-sans text-kiwimbi-dark dark:text-gray-300">

    <div id="toast-container" class="fixed top-5 right-5 z-50"></div>

    <header class="bg-kiwimbi-green lightgreen:bg-kiwimbi-green shadow-lg w-full py-4 px-4 md:px-6">
      <div class="container mx-auto flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <img src="download.webp" alt="Kiwimbi Kenya Logo" class="h-24 w-auto bg-white rounded-full p-1 object-contain" />
          <div>
              <h1 class="text-lg md:text-3xl font-bold text-white tracking-wider">
                  Kiwimbi Kenya Staff Attendance Register
              </h1>
              <h2 class="text-xs md:text-base text-gray-200 tracking-wide">
                  Opportunity Through Education
              </h2>
          </div>
        </div>
        <div class="flex items-center space-x-4">
            <div id="desktop-clock" class="hidden sm:block text-right text-white">
              <p class="font-semibold text-lg"></p>
              <p class="text-xs"></p>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full text-white hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white transition-colors" aria-label="Toggle dark mode">
                {/* SVG icons will be injected by JS */}
            </button>
        </div>
      </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-1 flex flex-col gap-8">
            
            <!-- Attendance Form -->
            <div class="bg-white dark:bg-kiwimbi-darkgreen p-6 rounded-lg shadow-md">
              <h3 class="text-2xl font-bold mb-6 text-kiwimbi-dark dark:text-white border-b-2 border-kiwimbi-green pb-2">Attendance Log</h3>
              <div class="space-y-4">
                <div>
                  <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Full Name</label>
                  <input id="name-input" type="text" placeholder="Enter your full name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-kiwimbi-blue focus:border-kiwimbi-blue" aria-required="true" />
                </div>
                <div>
                  <label for="role-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Role / Department</label>
                  <select id="role-select" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md shadow-sm focus:ring-kiwimbi-blue focus:border-kiwimbi-blue"></select>
                </div>
                <p id="form-error" class="text-red-500 text-sm" role="alert"></p>
                <div class="flex space-x-4 pt-4">
                  <button id="check-in-btn" class="w-full bg-kiwimbi-green text-white font-bold py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-300" aria-label="Check In">Check In</button>
                  <button id="check-out-btn" class="w-full bg-kiwimbi-blue text-white font-bold py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-300" aria-label="Check Out">Check Out</button>
                </div>
              </div>
            </div>

            <!-- Photo Section -->
            <div class="bg-white dark:bg-kiwimbi-darkgreen p-6 rounded-lg shadow-md">
                <h3 class="text-2xl font-bold mb-4 text-kiwimbi-dark dark:text-white border-b-2 border-kiwimbi-green pb-2">
                    Our Community
                </h3>
                <div class="relative w-full h-72 rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-700">
                    <!-- Slider Track -->
                    <div id="image-slider" class="flex h-full transition-transform duration-500 ease-in-out">
                        <!-- Slide 1 -->
                        <div class="w-full h-full flex-shrink-0">
                            <img src="kiwimbi lib.jpg" alt="Kiwimbi Community Image 1" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                            <div class="w-full h-full hidden items-center justify-center text-center text-gray-500 dark:text-gray-400 p-4"><span>Your First Photo Here</span></div>
                        </div>
                        <!-- Slide 2 -->
                        <div class="w-full h-full flex-shrink-0">
                             <img src="OIP.jpg" alt="Kiwimbi Community Image 2" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                             <div class="w-full h-full hidden items-center justify-center text-center text-gray-500 dark:text-gray-400 p-4"><span>Your Second Photo Here</span></div>
                        </div>
                        <!-- Slide 3 -->
                        <div class="w-full h-full flex-shrink-0">
                             <img src="#" alt="Kiwimbi Community Image 3" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                             <div class="w-full h-full hidden items-center justify-center text-center text-gray-500 dark:text-gray-400 p-4"><span>Your Third Photo Here</span></div>
                        </div>
                        <!-- Slide 4 -->
                        <div class="w-full h-full flex-shrink-0">
                            <img src="#" alt="Kiwimbi Community Image 1" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                            <div class="w-full h-full hidden items-center justify-center text-center text-gray-500 dark:text-gray-400 p-4"><span>Your First Photo Here</span></div>
                        </div>
                    </div>
            
                    <!-- Navigation Buttons -->
                    <button id="prev-slide-btn" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-black/30 text-white p-2 rounded-full hover:bg-black/50 focus:outline-none transition-opacity opacity-0 hover:opacity-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </button>
                    <button id="next-slide-btn" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-black/30 text-white p-2 rounded-full hover:bg-black/50 focus:outline-none transition-opacity opacity-0 hover:opacity-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </button>
            
                    <!-- Dot Indicators -->
                    <div id="slider-dots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">
                        <!-- Dots will be added by JS -->
                    </div>
                </div>
                <p class="mt-4 text-gray-600 dark:text-gray-300">
                    A gallery showcasing the vibrant Kiwimbi team and students.
                </p>
            </div>
          </div>
          
          <!-- Attendance Table -->
          <div class="lg:col-span-2 bg-white dark:bg-kiwimbi-darkgreen p-6 rounded-lg shadow-md">
            <div class="flex justify-between items-center mb-4 pb-2 border-b-2 border-kiwimbi-green">
                <h3 class="text-2xl font-bold text-kiwimbi-dark dark:text-white">Daily Records</h3>
                <button id="export-csv-btn" class="flex items-center bg-white text-kiwimbi-blue border border-kiwimbi-blue font-bold py-2 px-4 rounded-md hover:bg-blue-50 dark:bg-gray-700 dark:text-blue-300 dark:border-blue-300 dark:hover:bg-gray-600 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:text-gray-400 dark:disabled:text-gray-500 disabled:cursor-not-allowed disabled:border-gray-300 dark:disabled:border-gray-600 transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 9.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 7.414V13a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                    </svg>
                    Export CSV
                </button>
            </div>
            <div id="table-container" class="overflow-x-auto">
                {/* Table will be rendered here by JS */}
            </div>
          </div>
        </div>
        
        <!-- Mobile Clock -->
        <div id="mobile-clock" class="sm:hidden mt-8 p-4 bg-kiwimbi-green dark:bg-kiwimbi-darkgreen rounded-lg shadow-lg text-right text-white">
            <p class="font-semibold text-lg"></p>
            <p class="text-xs"></p>
        </div>
    </main>

    <footer class="text-center p-4 mt-8 text-sm text-gray-500 dark:text-gray-400">
        <p>&copy; <span id="footer-year"></span> Kiwimbi Kenya. All Rights Reserved.</p>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- STATE & CONSTANTS ---
    const ROLES = ['Teaching Assistant', 'Library Staff', 'Redwood', 'Tailoring Department'];
    let records = [];
    let todayKey = new Date().toISOString().split('T')[0];
    let currentSlide = 0;
    let slides = [];

    // --- DOM ELEMENTS ---
    const nameInput = document.getElementById('name-input');
    const roleSelect = document.getElementById('role-select');
    const formError = document.getElementById('form-error');
    const checkInBtn = document.getElementById('check-in-btn');
    const checkOutBtn = document.getElementById('check-out-btn');
    const tableContainer = document.getElementById('table-container');
    const exportCsvBtn = document.getElementById('export-csv-btn');
    const themeToggle = document.getElementById('theme-toggle');
    const desktopClockTime = document.querySelector('#desktop-clock p:first-child');
    const desktopClockDate = document.querySelector('#desktop-clock p:last-child');
    const mobileClockTime = document.querySelector('#mobile-clock p:first-child');
    const mobileClockDate = document.querySelector('#mobile-clock p:last-child');
    const toastContainer = document.getElementById('toast-container');
    const imageSlider = document.getElementById('image-slider');
    const prevSlideBtn = document.getElementById('prev-slide-btn');
    const nextSlideBtn = document.getElementById('next-slide-btn');
    const sliderDotsContainer = document.getElementById('slider-dots');
    document.getElementById('footer-year').textContent = new Date().getFullYear();

    // --- ICONS ---
    const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`;
    const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`;

    // --- UTILITY FUNCTIONS ---
    const isLate = (role, checkInTime) => {
        const day = checkInTime.getDay(); // 0=Sun, 1=Mon, ..., 6=Sat
        const hours = checkInTime.getHours();
        const minutes = checkInTime.getMinutes();
        if (day === 5 || day === 6) return hours > 8 || (hours === 8 && minutes > 0);
        if (day >= 1 && day <= 4) {
            if (role === 'Teaching Assistant') return hours > 7 || (hours === 7 && minutes > 0);
            return hours > 8 || (hours === 8 && minutes > 0);
        }
        return false;
    };

    const showToast = (message, type = 'success') => {
        const toast = document.createElement('div');
        const typeClasses = type === 'success' ? 'bg-kiwimbi-green' : 'bg-red-500';
        toast.className = `p-4 rounded-lg shadow-xl text-white transform transition-all duration-300 ease-in-out z-50 animate-slide-in ${typeClasses}`;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.innerHTML = `
            <div class="flex items-center justify-between">
                <span class="mr-4">${message}</span>
                <button class="font-bold text-lg leading-none" aria-label="Close notification">&times;</button>
            </div>`;
        toastContainer.appendChild(toast);
        toast.querySelector('button').onclick = () => toast.remove();
        setTimeout(() => toast.remove(), 3000);
    };

    // --- LOCAL STORAGE & DATE HANDLING ---
    const jsonReviver = (key, value) => {
        if ((key === 'checkInTime' || key === 'checkOutTime') && value) {
            return new Date(value);
        }
        return value;
    };

    const saveRecords = () => {
        localStorage.setItem(todayKey, JSON.stringify(records));
    };

    const loadRecords = () => {
        const storedRecords = localStorage.getItem(todayKey);
        records = storedRecords ? JSON.parse(storedRecords, jsonReviver) : [];
        renderTable();
    };
    
    // Periodically check if the day has changed
    setInterval(() => {
        const newTodayKey = new Date().toISOString().split('T')[0];
        if (newTodayKey !== todayKey) {
            todayKey = newTodayKey;
            loadRecords(); // Load records for the new day
        }
    }, 60000);

    // --- RENDER FUNCTIONS ---
    const renderTable = () => {
        exportCsvBtn.disabled = records.length === 0;

        if (records.length === 0) {
            tableContainer.innerHTML = `
                <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                    <p class="text-lg">No attendance records for today.</p>
                    <p>Use the form to check in.</p>
                </div>`;
            return;
        }

        const sortedRecords = [...records].sort((a, b) => b.checkInTime.getTime() - a.checkInTime.getTime());
        const formatTime = (date) => date ? new Date(date).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }) : 'N/A';

        const tableHTML = `
            <table class="w-full min-w-max text-left">
              <thead>
                <tr class="border-b border-gray-200 dark:border-gray-700">
                  <th class="p-3 text-sm font-semibold uppercase text-gray-600 dark:text-gray-400">Name</th>
                  <th class="p-3 text-sm font-semibold uppercase text-gray-600 dark:text-gray-400">Role</th>
                  <th class="p-3 text-sm font-semibold uppercase text-gray-600 dark:text-gray-400">Check In</th>
                  <th class="p-3 text-sm font-semibold uppercase text-gray-600 dark:text-gray-400">Check Out</th>
                  <th class="p-3 text-sm font-semibold uppercase text-gray-600 dark:text-gray-400">Status</th>
                </tr>
              </thead>
              <tbody>
                ${sortedRecords.map(record => `
                  <tr class="border-b border-gray-100 dark:border-gray-800 hover:bg-kiwimbi-lightgreen dark:hover:bg-gray-800">
                    <td class="p-3 font-medium text-gray-800 dark:text-gray-200">${record.name}</td>
                    <td class="p-3 text-gray-600 dark:text-gray-400">${record.role}</td>
                    <td class="p-3 text-gray-600 dark:text-gray-400">${formatTime(record.checkInTime)}</td>
                    <td class="p-3 text-gray-600 dark:text-gray-400">${formatTime(record.checkOutTime)}</td>
                    <td class="p-3">
                      <span class="px-3 py-1 text-xs font-semibold rounded-full ${ record.status === 'Late' ? 'bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300' : 'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300' }">
                        ${record.status}
                      </span>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>`;
        tableContainer.innerHTML = tableHTML;
    };

    const updateClock = () => {
        const now = new Date();
        const timeString = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
        const dateString = now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        desktopClockTime.textContent = timeString;
        desktopClockDate.textContent = dateString;
        mobileClockTime.textContent = timeString;
        mobileClockDate.textContent = dateString;
    };
    
    // --- EVENT HANDLERS ---
    const handleCheckIn = () => {
        const name = nameInput.value.trim();
        const role = roleSelect.value;
        if (!name) {
            formError.textContent = 'Name is required.';
            return;
        }
        formError.textContent = '';
        if (records.some(r => r.name.toLowerCase() === name.toLowerCase() && !r.checkOutTime)) {
            showToast(`${name} is already checked in.`, 'error');
            return;
        }
        const now = new Date();
        const newRecord = { id: Date.now(), name, role, checkInTime: now, checkOutTime: null, status: isLate(role, now) ? 'Late' : 'On Time' };
        records.push(newRecord);
        saveRecords();
        renderTable();
        showToast(`Welcome, ${name}! You've been checked in.`, 'success');
        nameInput.value = '';
    };

    const handleCheckOut = () => {
        const name = nameInput.value.trim();
        if (!name) {
            formError.textContent = 'Name is required.';
            return;
        }
        formError.textContent = '';
        const recordIndex = records.findIndex(r => r.name.toLowerCase() === name.toLowerCase() && !r.checkOutTime);
        if (recordIndex === -1) {
            showToast(`${name} is not checked in or has already checked out.`, 'error');
            return;
        }
        records[recordIndex].checkOutTime = new Date();
        saveRecords();
        renderTable();
        showToast(`Goodbye, ${name}! You've been checked out.`, 'success');
        nameInput.value = '';
    };
    
    const handleExport = () => {
        if (records.length === 0) return;

        const formatTimeForCsv = (date) => date ? new Date(date).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) : '';
        const formatDateForCsv = (date) => date ? new Date(date).toLocaleDateString('en-CA') : ''; // YYYY-MM-DD
        
        const headers = ['Name', 'Role', 'Date', 'CheckInTime', 'CheckOutTime', 'Status'];
        const csvRows = [headers.join(','), ...records.map(r => [`"${r.name}"`, `"${r.role}"`, formatDateForCsv(r.checkInTime), formatTimeForCsv(r.checkInTime), formatTimeForCsv(r.checkOutTime), r.status].join(','))];
        const csvContent = csvRows.join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `kiwimbi-attendance-${todayKey}.csv`;
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href);
    };

    // --- THEME ---
    const applyTheme = (theme) => {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark');
            themeToggle.innerHTML = sunIcon;
        } else {
            document.documentElement.classList.remove('dark');
            themeToggle.innerHTML = moonIcon;
        }
    };

    themeToggle.addEventListener('click', () => {
        const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
    });
    
    // --- SLIDER ---
    const updateSlider = () => {
        if (!imageSlider) return;
        imageSlider.style.transform = `translateX(-${currentSlide * 100}%)`;

        const dots = sliderDotsContainer.children;
        for (let i = 0; i < dots.length; i++) {
            dots[i].classList.toggle('bg-white', i === currentSlide);
            dots[i].classList.toggle('bg-white/50', i !== currentSlide);
        }
    };

    const initSlider = () => {
        slides = imageSlider.children;
        if (slides.length <= 1) {
            prevSlideBtn.style.display = 'none';
            nextSlideBtn.style.display = 'none';
            return;
        }

        for (let i = 0; i < slides.length; i++) {
            const dot = document.createElement('button');
            dot.classList.add('w-3', 'h-3', 'rounded-full', 'transition-colors', 'cursor-pointer');
            dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
            dot.addEventListener('click', () => {
                currentSlide = i;
                updateSlider();
            });
            sliderDotsContainer.appendChild(dot);
        }

        nextSlideBtn.addEventListener('click', () => {
            currentSlide = (currentSlide + 1) % slides.length;
            updateSlider();
        });

        prevSlideBtn.addEventListener('click', () => {
            currentSlide = (currentSlide - 1 + slides.length) % slides.length;
            updateSlider();
        });
        
        updateSlider();
    };


    // --- INITIALIZATION ---
    // Populate role selector
    roleSelect.innerHTML = ROLES.map(r => `<option value="${r}">${r}</option>`).join('');

    // Attach event listeners
    checkInBtn.addEventListener('click', handleCheckIn);
    checkOutBtn.addEventListener('click', handleCheckOut);
    exportCsvBtn.addEventListener('click', handleExport);
    
    // Initial load
    const savedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(savedTheme);
    loadRecords();
    updateClock();
    setInterval(updateClock, 1000);
    initSlider();
});
</script>

</body>
</html>